---
title: 用浙大的VPN上网，还需要一点玄学(?)
date: "2015-05-21 20:33:00"
tags:
- dairy
- network
---

目指世界一流大学的母校浙大，似乎并不觉得网速和它的目标有什么关系……如果在浙大的寝室之类，用学校的L2TP VPN上网——尤其是用自己的路由器连接VPN上网，却发现看视频或者下载大文件时经常会中断，那下面这个办法说不定能解决问题。

试着在看视频的时候拿Wireshark抓个包，最好用Bilibili这种播放器比较垃圾，解决不了太多网络问题的视频站。视频加载卡住之前一般能看到一大串的`TCP Dup ACK`和`TCP Out-Of-Order`，就像这样：

![](/assets/0206-01.png)

如果和这类似，那有相当大的可能是路由器[MTU值][MTU]的锅。随便猜一下原因：MTU的大小一般是自动发现的；但浙大的网络似乎过滤了部分ICMP包（结果之一是用学校分配的静态地址Ping不到寝室电脑），导致自动发现失效，VPN服务器的MTU设置又和大部分其他地方的L2TP VPN采用的1460不一样。于是小流量的时候没什么问题，流量一大就各种丢包。

**解决方法是，在路由器的WAN口连接设置里（TP-LINK的话，`网络参数`->`WAN口设置`），把MTU的值改成`1428`这个玄学的数字。**

改完之后断开路由器的VPN连接再重连。第一次连接时间可能会很长，耐心等一下。重新开视频抓包试试，如果`TCP Dup ACK`几乎消失，那就算解决了。

题外话，cc98那里关于这个问题还有几个不同的玄学数字，比如1410、144X之类。

[MTU]: http://www.wikiwand.com/zh/%E6%9C%80%E5%A4%A7%E4%BC%A0%E8%BE%93%E5%8D%95%E5%85%83